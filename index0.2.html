<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¨Ø­Ø« ÙÙŠ Ù…Ù„Ù Excel - Ù…ØªÙƒØ§Ù…Ù„</title>

  <!-- Ù…ÙƒØªØ¨Ø© Ù‚Ø±Ø§Ø¡Ø© Ø¥ÙƒØ³Ù„ Ùˆ Ù‚Ø§Ø±Ø¦ QR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8"></script>

  <style>
    /* Ø¹Ø§Ù… */
    body {
      font-family: Arial, sans-serif;
      background: #fafafa;
      color: #222;
      margin: 0;
      padding: 18px;
      box-sizing: border-box;
    }
    h2 { text-align: center; margin: 6px 0 12px 0; }

    /* Ø­Ø§Ù„Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ */
    #status {
      position: fixed;
      top: 12px;
      right: 12px;
      padding: 8px 12px;
      border-radius: 6px;
      color: #fff;
      font-weight: bold;
      z-index: 50;
    }
    #status.active { background: #28a745; }
    #status.inactive { background: #dc3545; }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ */
    #loginBox {
      display: block;
      text-align: center;
      margin: 18px auto;
    }
    #passwordInput {
      width: 220px;
      font-size: 20px;
      padding: 8px;
      text-align: center;
    }
    .numpad {
      width: 220px;
      margin: 12px auto 0 auto;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    .numpad button {
      padding: 12px;
      font-size: 18px;
      border-radius: 6px;
      border: 1px solid #ccc;
      background: #f0f0f0;
      cursor: pointer;
    }

    /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
    #app { display: none; }

    /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« + Ø£Ø²Ø±Ø§Ø± */
    .searchRow {
      text-align: center;
      margin: 8px 0 14px 0;
    }
    #searchBar {
      width: 60%;
      max-width: 520px;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .btn {
      padding: 10px 14px;
      margin: 0 6px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 15px;
    }
    .btn.primary { background: #0d6efd; color: #fff; }
    .btn.ghost { background: #e9ecef; }
    .btn.camera { background: #20c997; color: #fff; }

    /* Ù‚Ø§Ø±Ø¦ QR */
    #reader { width: 320px; margin: 8px auto; display: none; }

    /* ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙˆÙ„ÙŠÙ† */
    .tables {
      display: flex;
      gap: 18px;
      justify-content: space-between;
      align-items: flex-start;
      margin-top: 16px;
    }
    .col { width: 48%; background: #fff; padding: 12px; border-radius: 8px; box-shadow: 0 1px 6px rgba(0,0,0,0.04); box-sizing: border-box; }

    /* Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø£ØµÙ„ÙŠ (id="results") */
    table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed; /* Ø«Ø§Ø¨Øª Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
      word-wrap: break-word;
    }
    thead th {
      background: #f2f2f2;
      padding: 8px;
      border: 1px solid #ddd;
      font-weight: 600;
    }
    tbody td {
      padding: 8px;
      border: 1px solid #ddd;
      text-align: center;
      vertical-align: middle;
    }
    /* ØªØ®ØµÙŠØµ Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª (Ù†Ø³Ø¨Ø©) ÙƒÙŠ Ù„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¢Ø®Ø± */
    /* 5 Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« (Ø¢Ø®Ø± Ø¹Ù…ÙˆØ¯ Ø²Ø± Ø¥Ø¶Ø§ÙØ©)ØŒ 5 Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ finalResults */
    /* Ù†Ø³ØªØ®Ø¯Ù… Ù†Ø³Ø¨ Ù…ØªÙ†Ø§Ø³Ø¨Ø© */
    .col table th:nth-child(1), .col table td:nth-child(1) { width: 30%; }
    .col table th:nth-child(2), .col table td:nth-child(2) { width: 18%; }
    .col table th:nth-child(3), .col table td:nth-child(3) { width: 18%; }
    .col table th:nth-child(4), .col table td:nth-child(4) { width: 18%; }
    .col table th:nth-child(5), .col table td:nth-child(5) { width: 16%; }

    /* Ø£Ø²Ø±Ø§Ø± ØµØºÙŠØ±Ø© */
    .addBtn { background:#198754; color:#fff; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; }
    .delBtn { background:#dc3545; color:#fff; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; }

    /* Ø²Ø± Ø­Ø°Ù Ø§Ù„ÙƒÙ„ */
    #clearAllBtn { background:#dc3545; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; margin-bottom:8px; }

    /* responsive */
    @media (max-width:900px) {
      .tables { flex-direction: column; }
      .col { width: 100%; }
      #reader { width: 100%; }
      #searchBar { width: 85%; }
    }
  </style>
</head>
<body>
  <h2>Ø¨Ø­Ø« ÙÙŠ Ù…Ù„Ù Excel â€” Ù†Ø³Ø®Ø© Ù…ØªÙƒØ§Ù…Ù„Ø©</h2>

  <!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ -->
  <div id="status" class="inactive">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù ÙØ¹Ø§Ù„</div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù…Ø¹ ÙƒÙŠØ¨ÙˆØ±Ø¯ Ø£Ø±Ù‚Ø§Ù… -->
  <div id="loginBox">
    <input id="passwordInput" type="password" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" readonly />
    <div class="numpad">
      <div class="numpad">
        <button onclick="pressDigit('1')">1</button>
        <button onclick="pressDigit('2')">2</button>
        <button onclick="pressDigit('3')">3</button>
        <button onclick="pressDigit('4')">4</button>
        <button onclick="pressDigit('5')">5</button>
        <button onclick="pressDigit('6')">6</button>
        <button onclick="pressDigit('7')">7</button>
        <button onclick="pressDigit('8')">8</button>
        <button onclick="pressDigit('9')">9</button>
        <button onclick="backspacePass()">âŒ«</button>
        <button onclick="pressDigit('0')">0</button>
        <button onclick="submitPass()">â</button>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
  <div id="app">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø¨Ø­Ø« -->
    <div class="searchRow">
      <input id="searchBar" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" />
      <button id="searchBtn" class="btn primary" onclick="search(false)">Ø¨Ø­Ø«</button>
      <button id="clearBtn" class="btn ghost" onclick="clearSearch()">Ø­Ø°Ù</button>
      <button id="cameraBtn" class="btn camera" onclick="toggleCamera()">ğŸ“·</button>
    </div>

    <!-- Ù‚Ø§Ø±Ø¦ QR ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    <div id="reader" ></div>

    <!-- Ø¬Ø¯ÙˆÙ„Ø§Ù† -->
    <div class="tables">
      <!-- Ø¹Ù…ÙˆØ¯ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« (ÙŠØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ results Ø§Ù„Ø£ØµÙ„ÙŠ) -->
      <div class="col">
        <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h3>
        <table id="results">
          <!-- Ø³ÙŠÙÙ…Ù„Ø£ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø¨Ù†ÙØ³ Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ -->
        </table>
      </div>

      <!-- Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© -->
      <div class="col">
        <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h3>
        <div style="text-align:left; margin-bottom:6px;">
          <button id="clearAllBtn" onclick="clearAllSelected()" style="display:none;">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
        </div>
        <table id="finalResults">
          <!-- ÙŠÙ…Ù„Ø£ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ -->
        </table>
      </div>
    </div>
  </div>

  <script>
    /********* Ù…ØªØºÙŠØ±Ø§Øª *********/
    let excelData = [];         // Ù…ØµÙÙˆÙØ© ØµÙÙˆÙ Ø§Ù„Ø¥ÙƒØ³Ù„ (ÙƒÙ„ ØµÙ Ù…ØµÙÙˆÙØ© Ù…Ù† Ø§Ù„Ø®Ù„Ø§ÙŠØ§)
    let qrScanner = null;       // Ù…Ø«ÙŠÙ„ html5-qrcode
    let scanning = false;       // Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø­
    const correctPassword = "1234"; // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø¹Ø¯Ù„ Ù„Ùˆ Ø­Ø¨ÙŠØª)

    // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø©
    const statusEl = document.getElementById('status');
    const loginBox = document.getElementById('loginBox');
    const app = document.getElementById('app');
    const passwordInput = document.getElementById('passwordInput');

    const searchBar = document.getElementById('searchBar');
    const resultsTable = document.getElementById('results');
    const finalResults = document.getElementById('finalResults');
    const readerDiv = document.getElementById('reader');
    const clearAllBtn = document.getElementById('clearAllBtn');

    const headers = ["Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬", "Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬", "ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†", "QR Code"];

    /********* ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø§ÙƒØ³Ù„ ÙƒÙ…Ø§ ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ *********/
    fetch("product.template(176).xlsx")
      .then(res => res.arrayBuffer())
      .then(data => {
        try {
          const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
          const firstSheet = workbook.SheetNames[0];
          excelData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet], { header: 1 });
          statusEl.textContent = "Ù…Ù„Ù ÙØ¹Ø§Ù„";
          statusEl.className = "active";
        } catch (err) {
          console.error("Ø®Ø·Ø£ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥ÙƒØ³Ù„:", err);
          statusEl.textContent = "Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
          statusEl.className = "inactive";
        }
      })
      .catch(err => {
        console.warn("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„:", err);
        statusEl.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù ÙØ¹Ø§Ù„";
        statusEl.className = "inactive";
      });

    /********* ÙˆØ¸Ø§Ø¦Ù Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ (ÙƒÙŠØ¨ÙˆØ±Ø¯ Ø£Ø±Ù‚Ø§Ù…) *********/
    function pressDigit(d) {
      passwordInput.value = (passwordInput.value || "") + d;
    }
    function backspacePass() {
      passwordInput.value = (passwordInput.value || "").slice(0, -1);
    }
    function submitPass() {
      if ((passwordInput.value || "") === correctPassword) {
        loginBox.style.display = "none";
        app.style.display = "block";
        // ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø­Ø«
        setTimeout(() => searchBar.focus(), 200);
      } else {
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
      }
    }

    /********* ØªÙØ¹ÙŠÙ„ Enter Ùˆ Delete Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© *********/
    // Enter => Ø¨Ø­Ø«ØŒ Delete => Ø­Ø°Ù Ø¢Ø®Ø± ØµÙ Ù…Ù† finalResults
    document.addEventListener('keydown', (e) => {
      if (app.style.display === "block") {
        if (e.key === "Enter") {
          e.preventDefault();
          search(false);
        } else if (e.key === "Delete") {
          // Ø­Ø°Ù Ø¢Ø®Ø± ØµÙ (Ø¥Ø°Ø§ ÙˆØ¬Ø¯)
          const body = finalResults.tBodies[0];
          if (body && body.rows.length > 0) {
            body.deleteRow(body.rows.length - 1);
            checkClearAllVisibility();
          }
        }
      }
    });

    /********* Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¨Ø­Ø« ÙˆÙ…Ù„Ø¦ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª *********/
    // Ø¨Ø­Ø«: fromQR = true Ù„Ùˆ Ø£ØªØª Ù…Ù† Ù‚Ø§Ø±Ø¦ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ØŒ qrValue Ù‚ÙŠÙ…Ø© Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ù…Ø³ÙˆØ­
    function search(fromQR = false, qrValue = "") {
      const query = fromQR ? (qrValue + "").trim().toLowerCase() : (searchBar.value || "").trim().toLowerCase();
      if (!query) return;
      if (!Array.isArray(excelData) || excelData.length === 0) return;

      // Ù†Ø¹ÙŠØ¯ Ø¨Ù†Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ 'results' Ø¨Ù†ÙØ³ Ø´ÙƒÙ„Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ: Ø±Ø¤ÙˆØ³ Ø«Ù… ØµÙÙˆÙ
      let headerHtml = "<tr>";
      headers.forEach(h => headerHtml += `<th>${h}</th>`);
      headerHtml += "<th>Ø¥Ø¶Ø§ÙØ©</th></tr>";
      resultsTable.innerHTML = headerHtml;

      // Ù†Ù…Ø± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥ÙƒØ³Ù„ (ØªØ¬Ø§Ù‡Ù„ ØµÙ Ø§Ù„Ø±Ø¤ÙˆØ³ index=0 ÙƒÙ…Ø§ ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ)
      excelData.forEach((row, idx) => {
        if (idx === 0) return;
        const a = (row[0] || "").toString().toLowerCase();
        const b = (row[1] || "").toString();
        const c = (row[2] || "").toString().toLowerCase();
        const d = (row[3] || "").toString().toLowerCase();

        if (a.includes(query) || c.includes(query) || d.includes(query)) {
          // Ù†Ø¨Ù†ÙŠ ØµÙ DOM Ø­ØªÙ‰ Ù†Ø±Ø¨Ø· Ø­Ø¯Ø« Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
          const tr = document.createElement('tr');

          const td0 = document.createElement('td'); td0.textContent = row[0] || ""; tr.appendChild(td0);
          const td1 = document.createElement('td'); td1.textContent = row[1] || ""; tr.appendChild(td1);
          const td2 = document.createElement('td'); td2.textContent = row[2] || ""; tr.appendChild(td2);
          const td3 = document.createElement('td'); td3.textContent = row[3] || ""; tr.appendChild(td3);

          const tdAdd = document.createElement('td');
          // Ù„Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ø§ Ù†Ø¸Ù‡Ø± Ø²Ø± Ø¥Ø¶Ø§ÙØ© (Ù„Ø£Ù†Ù†Ø§ Ø³Ù†Ø¶ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)ØŒ ÙˆØ¥Ù„Ø§ Ù†Ø¸Ù‡Ø± Ø§Ù„Ø²Ø±
          if (!fromQR) {
            const btn = document.createElement('button');
            btn.className = 'addBtn';
            btn.textContent = 'Ø¥Ø¶Ø§ÙØ©';
            // Ø±Ø¨Ø· Ø§Ù„Ø­Ø¯Ø«: Ù†Ù…Ø±Ø± Ù†Ø³Ø®Ø© Ù…Ù† row
            btn.addEventListener('click', () => addToFinal(row));
            tdAdd.appendChild(btn);
          } else {
            tdAdd.textContent = '';
          }
          tr.appendChild(tdAdd);

          resultsTable.appendChild(tr);

          // Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©: Ø¥Ø°Ø§ Ø§Ù„Ø¨Ø­Ø« Ø¬Ø§Ø¡ Ù…Ù† Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ **Ø£Ùˆ** ÙƒØ§Ù† ØªØ·Ø§Ø¨Ù‚Ù‹Ø§ Ø¯Ø§Ø®Ù„ Ø¹Ù…ÙˆØ¯ QR (d.includes(query))
          if (fromQR || (d && d.includes(query))) {
            addToFinal(row);
          }
        }
      });
    }

    function clearSearch() {
      searchBar.value = "";
      resultsTable.innerHTML = ""; // ÙŠØ¸Ù„ Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙƒÙ…Ø§ ÙƒØ§Ù† (Ù†ÙØ³ Ø³Ù„ÙˆÙƒ Ø³Ø§Ø¨Ù‚)
    }

    /********* Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ (Ø§Ù„Ø´Ù…Ø§Ù„) ÙˆØ­Ø°Ù ØµÙ/Ø­Ø°Ù Ø§Ù„ÙƒÙ„ *********/
    function ensureFinalHeader() {
      if (!finalResults.tBodies.length) {
        const tbody = document.createElement('tbody');
        finalResults.appendChild(tbody);
      }
      // Ø¥Ø°Ø§ Ù„ÙŠØ³ Ù‡Ù†Ø§Ùƒ Ø±Ø£Ø³ØŒ Ù†Ø¶Ø¹Ù‡
      if (!finalResults.querySelector('thead')) {
        const thead = document.createElement('thead');
        let headHtml = "<tr>";
        headers.forEach(h => headHtml += `<th>${h}</th>`);
        headHtml += "<th>Ø­Ø°Ù</th></tr>";
        thead.innerHTML = headHtml;
        finalResults.insertBefore(thead, finalResults.tBodies[0]);
      }
    }

    function addToFinal(row) {
      ensureFinalHeader();
      // ØªØ­Ù‚Ù‚ Ø¨Ø³ÙŠØ· Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ø¹ØªÙ…Ø§Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø­Ù‚Ù„ QR (Ø§Ù„Ø¹Ù…ÙˆØ¯ 3)
      const qrVal = (row[3] || "").toString();
      const tbody = finalResults.tBodies[0];
      if (tbody) {
        const exists = Array.from(tbody.rows).some(r => (r.cells[3] && r.cells[3].textContent) === qrVal && qrVal !== "");
        if (exists) return;
      }

      const tr = document.createElement('tr');
      const td0 = document.createElement('td'); td0.textContent = row[0] || ""; tr.appendChild(td0);
      const td1 = document.createElement('td'); td1.textContent = row[1] || ""; tr.appendChild(td1);
      const td2 = document.createElement('td'); td2.textContent = row[2] || ""; tr.appendChild(td2);
      const td3 = document.createElement('td'); td3.textContent = row[3] || ""; tr.appendChild(td3);

      const tdDel = document.createElement('td');
      const delBtn = document.createElement('button');
      delBtn.className = 'delBtn';
      delBtn.textContent = 'Ø­Ø°Ù';
      delBtn.addEventListener('click', function() {
        this.closest('tr').remove();
        checkClearAllVisibility();
      });
      tdDel.appendChild(delBtn);
      tr.appendChild(tdDel);

      if (!finalResults.tBodies.length) finalResults.appendChild(document.createElement('tbody'));
      finalResults.tBodies[0].appendChild(tr);
      checkClearAllVisibility();
    }

    function clearAllSelected() {
      // Ø§Ø­Ø°Ù tbody Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆØ§Ø¨Ù‚Ù‰ Ø§Ù„Ø±Ø£Ø³ (Ù„Ùˆ Ø±ÙƒØ¨Øª Ø±Ø£Ø³)
      if (finalResults.tBodies[0]) finalResults.tBodies[0].innerHTML = "";
      checkClearAllVisibility();
    }

    function checkClearAllVisibility() {
      const body = finalResults.tBodies[0];
      if (!body || body.rows.length === 0) {
        clearAllBtn.style.display = 'none';
      } else {
        clearAllBtn.style.display = 'inline-block';
      }
    }

    /********* Ù‚Ø§Ø±Ø¦ QR (html5-qrcode) *********/
    function toggleCamera() {
      if (scanning) {
        // Ø¥ÙŠÙ‚Ø§Ù
        if (qrScanner) {
          qrScanner.stop().then(() => {
            qrScanner.clear();
            qrScanner = null;
            readerDiv.style.display = 'none';
            scanning = false;
          }).catch(err => {
            console.warn("Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:", err);
            readerDiv.style.display = 'none';
            scanning = false;
          });
        } else {
          readerDiv.style.display = 'none';
          scanning = false;
        }
      } else {
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø³Ø­
        readerDiv.style.display = 'block';
        qrScanner = new Html5Qrcode(/* element id */ "reader");
        const config = { fps: 10, qrbox: 250 };
        // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø³Ø­ â€” Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø³Ø­ Ø§Ù„Ù†Ø§Ø¬Ø­ Ù†Ù…Ø±Ø± Ø§Ù„Ù‚ÙŠÙ…Ø© Ù„Ù„Ø¨Ø­Ø« (isQR=true)
        qrScanner.start(
          { facingMode: "environment" },
          config,
          (decodedText, decodedResult) => {
            // Ù…Ù„Ø£ Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« Ø«Ù… Ù†ÙØ° Ø§Ù„Ø¨Ø­Ø« ÙƒÙ€ fromQR
            searchBar.value = decodedText;
            search(true, decodedText);
            // Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø«ÙˆØ± Ù†ÙˆÙ‚Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ…Ø§ ÙÙŠ Ø³Ù„ÙˆÙƒÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚
            toggleCamera();
          }
        ).catch(err => {
          alert("ÙØ´Ù„ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§/Ø§Ù„Ù…Ø³Ø­: " + err);
        });
        scanning = true;
      }
    }

    /********* ØªØ­ÙƒÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø²Ø± Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¬Ø§Ù†Ø¨ Ø§Ù„Ø¨Ø­Ø« Ù…ÙˆØ¬ÙˆØ¯) *********/
    // Ø²Ø± Ø§Ù„Ø¨Ø­Ø« ÙŠÙ‚Ø±Ø£ search(false)
    // Ø¯Ø¹Ù… Enter Ø£Ø¹Ù„Ø§Ù‡
    // Ø²Ø± Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ ÙŠØ¯Ù…Ø± Ø¢Ø®Ø± ØµÙ â€” Ù…Ù†ØµÙˆØµ Ø£Ø¹Ù„Ø§Ù‡

    /********* Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø© *********/
    // Ø¶Ø¹ Ù…Ù„Ù product.template(176).xlsx ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ù…Ø¹ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØ›
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø³ÙŠØ¸Ù‡Ø± "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù ÙØ¹Ø§Ù„" ÙÙŠ Ø§Ù„Ù…Ø¤Ø´Ø± ÙˆØ³ØªØ¸Ù„ ÙƒÙ„ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø¨ÙŠØ§Ù†Ø§Øª.
  </script>
</body>
</html>
