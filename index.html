<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¨Ø­Ø« ÙÙŠ Ù…Ù„Ù Excel - Ù†Ù‡Ø§Ø¦ÙŠ</title>

  <!-- Ù…ÙƒØªØ¨Ø§Øª -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.8"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#fafafa; color:#222; margin:0; padding:18px; box-sizing:border-box; }
    h2 { text-align:center; margin:6px 0 12px 0; }

    /* Ù…Ø¤Ø´Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§ÙƒØ³Ù„ */
    #status { position: fixed; top:12px; right:12px; padding:8px 12px; border-radius:6px; color:#fff; font-weight:700; z-index:50; }
    #status.active { background:#28a745; }
    #status.inactive { background:#dc3545; }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ */
    #loginBox { text-align:center; margin: 18px auto; }
    #passwordInput { width:220px; font-size:20px; padding:8px; text-align:center; }
    .numpad { width:220px; margin:12px auto 0; display:grid; grid-template-columns:repeat(3,1fr); gap:8px; }
    .numpad button { padding:12px; font-size:18px; border-radius:6px; border:1px solid #ccc; background:#f0f0f0; cursor:pointer; }

    /* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
    #app { display:none; margin-top:8px; }

    .searchRow { text-align:center; margin-bottom:12px; }
    #searchBar { width:60%; max-width:520px; padding:10px; font-size:16px; box-sizing:border-box; }
    .btn { padding:10px 14px; margin:0 6px; border-radius:6px; border:none; cursor:pointer; font-size:15px; }
    .btn.primary { background:#0d6efd; color:#fff; }
    .btn.ghost { background:#e9ecef; }
    .btn.camera { background:#20c997; color:#fff; }

    #reader, #readerScale { width:320px; margin:10px auto; display:none; }

    /* ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙˆÙ„ÙŠÙ† */
    .tables { display:flex; gap:18px; justify-content:space-between; align-items:flex-start; margin-top:16px; }
    .col { width:48%; background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 6px rgba(0,0,0,0.04); box-sizing:border-box; }

    /* Ø¬Ø¯Ø§ÙˆÙ„ Ù…ØªØ·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø´ÙƒÙ„ */
    table { width:100%; border-collapse:collapse; table-layout:fixed; word-wrap:break-word; }
    thead th { background:#f2f2f2; padding:8px; border:1px solid #ddd; font-weight:600; }
    tbody td { padding:8px; border:1px solid #ddd; text-align:center; vertical-align:middle; }

    /* Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø¹Ø±Ø¶ Ù†Ø³Ø¨ÙŠ Ø«Ø§Ø¨Øª */
    table th:nth-child(1), table td:nth-child(1) { width:30%; }
    table th:nth-child(2), table td:nth-child(2) { width:18%; }
    table th:nth-child(3), table td:nth-child(3) { width:18%; }
    table th:nth-child(4), table td:nth-child(4) { width:18%; }
    table th:nth-child(5), table td:nth-child(5) { width:16%; }

    .addBtn { background:#198754; color:#fff; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; }
    .delBtn { background:#dc3545; color:#fff; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; }
    #clearAllBtn { background:#dc3545; color:#fff; border:none; padding:8px 12px; border-radius:6px; cursor:pointer; margin-bottom:8px; display:none; }

    @media (max-width:900px) {
      .tables { flex-direction:column; }
      .col { width:100%; }
      #reader, #readerScale { width:100%; }
      #searchBar { width:85%; }
    }
  </style>
</head>
<body>
  <h2>Ø¨Ø­Ø« ÙÙŠ Ù…Ù„Ù Excel â€” Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>

  <!-- Ù…Ø¤Ø´Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù„Ù -->
  <div id="status" class="inactive">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù ÙØ¹Ø§Ù„</div>

  <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ -->
  <div id="loginBox">
    <input id="passwordInput" type="password" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" readonly />
    <div class="numpad">
      <button onclick="pressDigit('1')">1</button>
      <button onclick="pressDigit('2')">2</button>
      <button onclick="pressDigit('3')">3</button>
      <button onclick="pressDigit('4')">4</button>
      <button onclick="pressDigit('5')">5</button>
      <button onclick="pressDigit('6')">6</button>
      <button onclick="pressDigit('7')">7</button>
      <button onclick="pressDigit('8')">8</button>
      <button onclick="pressDigit('9')">9</button>
      <button onclick="backspacePass()">âŒ«</button>
      <button onclick="pressDigit('0')">0</button>
      <button onclick="submitPass()">â</button>
    </div>
  </div>

  <!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
  <div id="app">
    <div class="searchRow">
      <input id="searchBar" type="text" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬" />
      <button id="searchBtn" class="btn primary" onclick="search(false)">Ø¨Ø­Ø«</button>
      <button id="clearBtn" class="btn ghost" onclick="clearSearch()">Ø­Ø°Ù</button>
      <button id="cameraBtn" class="btn camera" onclick="toggleScanner('qr')">ğŸ“· QR</button>
      <button id="scaleBtn" class="btn camera" onclick="toggleScanner('scale')">ğŸ“¶ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†</button>
    </div>

    <!-- Ù‚Ø§Ø±Ø¦Ø§Ù† (Ù†ÙØ³ Ø§Ù„Ø¹Ù†ØµØ± ÙŠÙØ³ØªØ®Ø¯Ù… Ù„ÙƒÙ† Ù†Ø­ØªÙØ¸ Ø¨Ø¹Ù†ØµØ±ÙŠÙ† Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¸Ù‡ÙˆØ±) -->
    <div id="reader"></div>
    <div id="readerScale" style="display:none;"></div>

    <div class="tables">
      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« (ÙŠÙ…ÙŠÙ†) -->
      <div class="col">
        <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h3>
        <table id="results">
          <thead>
            <tr>
              <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th>Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†</th>
              <th>QR Code</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Ø´Ù…Ø§Ù„) -->
      <div class="col">
        <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</h3>
        <div style="text-align:left; margin-bottom:6px;">
          <button id="clearAllBtn" onclick="clearAllSelected()">Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
        </div>
        <table id="finalResults">
          <thead>
            <tr>
              <th>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th>Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬</th>
              <th>ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†</th>
              <th>QR Code</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    /* ===== Ù…ØªØºÙŠØ±Ø§Øª ===== */
    let excelData = [];
    let qrScanner = null;
    let scaleScanner = null;
    let scanningMode = null; // 'qr' Ø£Ùˆ 'scale' Ø£Ùˆ null
    const correctPassword = "1234";

    const statusEl = document.getElementById('status');
    const loginBox = document.getElementById('loginBox');
    const app = document.getElementById('app');
    const passwordInput = document.getElementById('passwordInput');

    const searchBar = document.getElementById('searchBar');
    const resultsTbody = document.querySelector('#results tbody');
    const finalTbody = document.querySelector('#finalResults tbody');
    const reader = document.getElementById('reader');
    const readerScale = document.getElementById('readerScale');
    const clearAllBtnEl = document.getElementById('clearAllBtn');

    const headers = ["Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬", "Ø³Ø¹Ø± Ø§Ù„Ù…Ù†ØªØ¬", "ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†", "QR Code"];

    /* ===== ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel ===== */
    fetch("product.template(176).xlsx")
      .then(res => res.arrayBuffer())
      .then(data => {
        try {
          const workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
          const firstSheet = workbook.SheetNames[0];
          excelData = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet], { header: 1 });
          statusEl.textContent = "Ù…Ù„Ù ÙØ¹Ø§Ù„";
          statusEl.className = "active";
        } catch (err) {
          console.error("Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥ÙƒØ³Ù„:", err);
          statusEl.textContent = "Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­";
          statusEl.className = "inactive";
        }
      })
      .catch(err => {
        console.warn("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„:", err);
        statusEl.textContent = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù ÙØ¹Ø§Ù„";
        statusEl.className = "inactive";
      });

    /* ===== Ø´Ø§Ø´Ø© Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ ===== */
    function pressDigit(d) { passwordInput.value = (passwordInput.value || "") + d; }
    function backspacePass() { passwordInput.value = (passwordInput.value || "").slice(0, -1); }
    function submitPass() {
      if ((passwordInput.value || "") === correctPassword) {
        loginBox.style.display = "none";
        app.style.display = "block";
        setTimeout(()=>searchBar.focus(), 150);
      } else alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }

    /* ===== ØªØ­ÙƒÙ…Ø§Øª ÙƒØ§Ù…Ù„Ø© Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (Enter, Delete) ===== */
    document.addEventListener('keydown', (e) => {
      if (app.style.display === "block") {
        if (e.key === 'Enter') {
          e.preventDefault();
          search(false);
        } else if (e.key === 'Delete') {
          // Ø§Ø­Ø°Ù Ø¢Ø®Ø± ØµÙ Ù…Ù† finalTbody Ø¥Ù† ÙˆØ¬Ø¯
          if (finalTbody.rows.length > 0) {
            finalTbody.deleteRow(finalTbody.rows.length - 1);
            checkClearAllVisibility();
          }
        }
      }
    });

    /* ===== Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø§Ù…Ø© =====
       fromScanner: boolean
       scannerType: 'qr' | 'scale' | '' 
       value: Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø§Ø³Ø­ (Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„Ùˆ fromScanner=true)
    */
    function search(fromScanner = false, scannerType = '', value = '') {
      const query = fromScanner ? (value + "").trim().toLowerCase() : (searchBar.value || "").trim().toLowerCase();
      if (!query) return;
      if (!Array.isArray(excelData) || excelData.length === 0) return;

      // Ù†Ø¸Ù‡Ø± Ø±Ø¤ÙˆØ³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ù†ÙØ³ Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ
      resultsTbody.innerHTML = "";
      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ø¨Ø± ØµÙÙˆÙ Ø§Ù„Ø¥ÙƒØ³Ù„ (ØªØ¬Ø§Ù‡Ù„ ØµÙ Ø§Ù„Ø±Ø¤ÙˆØ³ index=0 ÙƒÙ…Ø§ ÙÙŠ ÙƒÙˆØ¯Ùƒ)
      excelData.forEach((row, idx) => {
        if (idx === 0) return;
        const a = (row[0] || "").toString().toLowerCase();
        const b = (row[1] || "").toString();
        const c = (row[2] || "").toString().toLowerCase();
        const d = (row[3] || "").toString().toLowerCase();

        // Ø´Ø±Ø· Ø§Ù„Ø¸Ù‡ÙˆØ± ÙÙŠ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«
        if (a.includes(query) || c.includes(query) || d.includes(query)) {
          // Ù†Ø¨Ù†ÙŠ ØµÙ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø«
          const tr = document.createElement('tr');
          const td0 = document.createElement('td'); td0.textContent = row[0]||''; tr.appendChild(td0);
          const td1 = document.createElement('td'); td1.textContent = row[1]||''; tr.appendChild(td1);
          const td2 = document.createElement('td'); td2.textContent = row[2]||''; tr.appendChild(td2);
          const td3 = document.createElement('td'); td3.textContent = row[3]||''; tr.appendChild(td3);

          const tdAction = document.createElement('td');
          // Ù„Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø¬Ø§Ø¡ Ù…Ù† Ù…Ø§Ø³Ø­ Ù†Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© (Ù„Ø£Ù†Ù†Ø§ Ø³Ù†Ø¶ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
          if (!fromScanner) {
            const addBtn = document.createElement('button');
            addBtn.className = 'addBtn';
            addBtn.textContent = 'Ø¥Ø¶Ø§ÙØ©';
            addBtn.addEventListener('click', () => addToFinal(row));
            tdAction.appendChild(addBtn);
          } else {
            tdAction.textContent = '';
          }
          tr.appendChild(tdAction);

          resultsTbody.appendChild(tr);

          // Ø¥Ø¶Ø§ÙØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø´Ø±ÙˆØ·ÙŠØ©:
          // - Ù„Ùˆ Ø¬Ø§Ø¡ Ù…Ù† Ù…Ø§Ø³Ø­ qr Ø£Ùˆ scale Ù†Ø¶ÙŠÙ Ù…Ø¨Ø§Ø´Ø±Ø©
          // - Ø£Ùˆ Ù„Ùˆ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙŠØ¯ÙˆÙŠ ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø¹Ù…ÙˆØ¯ QR (d.includes(query)) Ø£Ùˆ Ù…Ø¹ Ø¹Ù…ÙˆØ¯ Ø§Ù„ÙƒÙˆØ¯ (c.includes(query))
          if (
            fromScanner ||
            (d && d.includes(query)) ||
            (c && c.includes(query))
          ) {
            addToFinal(row);
          }
        }
      });
    }

    function clearSearch() {
      searchBar.value = "";
      resultsTbody.innerHTML = ""; // Ù†ØµØ­Ùƒ Ø­Ø§ÙØ¸Ù†Ø§ Ø¹Ù„Ù‰ Ø¹Ø¯Ù… ØªØºÙŠÙŠØ± Ø£ÙŠ Ø´Ø¦ Ø³ÙˆÙ‰ ØªÙ†Ø¸ÙŠÙ
    }

    /* ===== ÙˆØ¸Ø§Ø¦Ù final table (Ø¥Ø¶Ø§ÙØ©/Ø­Ø°Ù/Ø­Ø°Ù Ø§Ù„ÙƒÙ„) ===== */
    function addToFinal(row) {
      // Ø£Ù†Ø´Ø¦ Ø±Ø£Ø³ finalResults Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ (ØªÙ… Ø§Ù„Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø£Ø³ Ø§Ù„Ø£ÙˆÙ„ÙŠ ÙÙŠ HTMLØŒ Ù„ÙƒÙ† Ù†ØªØ£ÙƒØ¯)
      if (!finalTbody) return;
      // Ù…Ù†Ø¹ ØªÙƒØ±Ø§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ QR Ø£Ùˆ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù† (Ù†Ø®ØªØ§Ø± QR Ø¥Ù† ÙˆÙØ¬Ø¯)
      const qrVal = (row[3] || "").toString();
      const codeVal = (row[2] || "").toString();

      const exists = Array.from(finalTbody.rows).some(r => {
        const rQr = (r.cells[3] && r.cells[3].textContent) || "";
        const rCode = (r.cells[2] && r.cells[2].textContent) || "";
        return (rQr === qrVal && qrVal !== "") || (rCode === codeVal && codeVal !== "");
      });
      if (exists) return;

      const tr = document.createElement('tr');
      const td0 = document.createElement('td'); td0.textContent = row[0]||''; tr.appendChild(td0);
      const td1 = document.createElement('td'); td1.textContent = row[1]||''; tr.appendChild(td1);
      const td2 = document.createElement('td'); td2.textContent = row[2]||''; tr.appendChild(td2);
      const td3 = document.createElement('td'); td3.textContent = row[3]||''; tr.appendChild(td3);

      const tdDel = document.createElement('td');
      const delBtn = document.createElement('button');
      delBtn.className = 'delBtn';
      delBtn.textContent = 'Ø­Ø°Ù';
      delBtn.addEventListener('click', function() {
        this.closest('tr').remove();
        checkClearAllVisibility();
      });
      tdDel.appendChild(delBtn);
      tr.appendChild(tdDel);

      finalTbody.appendChild(tr);
      checkClearAllVisibility();
    }

    function clearAllSelected() {
      if (finalTbody) finalTbody.innerHTML = "";
      checkClearAllVisibility();
    }

    function checkClearAllVisibility() {
      if (!finalTbody || finalTbody.rows.length === 0) {
        clearAllBtnEl.style.display = 'none';
      } else {
        clearAllBtnEl.style.display = 'inline-block';
      }
    }

    /* ===== Ù‚Ø§Ø±Ø¦Ø§Ù† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… html5-qrcode =====
       Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…Ø±ØªÙŠÙ† Ù…Ø¹ Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø±Ø¦ Ù…Ø®ØµØµ Ù„ÙƒÙ„ ÙˆØ¶Ø¹
    */
    function toggleScanner(mode) {
      // mode: 'qr' Ø£Ùˆ 'scale'
      if (scanningMode === mode) {
        // Ù†ÙˆÙ‚Ù Ø§Ù„Ù…Ø³Ø­
        stopScanner(mode);
        return;
      }
      // Ù„Ùˆ Ø¬Ø§Ø±Ù Ù…Ø³Ø­ Ù„ÙˆØ¶Ø¹ Ø¢Ø®Ø±ØŒ Ù†ÙˆÙ‚ÙÙ‡ Ø£ÙˆÙ„Ø§Ù‹
      if (scanningMode) stopScanner(scanningMode);
      startScanner(mode);
    }

    function startScanner(mode) {
      scanningMode = mode;
      const targetDiv = (mode === 'qr') ? reader : readerScale;
      targetDiv.style.display = 'block';
      const config = { fps: 10, qrbox: 250 };
      const constraints = { facingMode: { exact: "environment" } };

      // Ø§Ù†Ø´Ø§Ø¡ Ù…Ø«ÙŠÙ„ Ù…Ù†ÙØµÙ„ Ù„ÙƒÙ„ ÙˆØ¶Ø¹ Ù„ØªØ¬Ù†Ø¨ ØªØ¹Ø§Ø±Ø¶ callbacks
      const scanner = new Html5Qrcode(targetDiv.id);
      const onSuccess = (decodedText, decodedResult) => {
        // decodedText Ù‡Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ù…Ø³ÙˆØ­Ø©
        // Ù†ÙˆÙ‚Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙÙˆØ±Ø§Ù‹ Ù„Ù†Ù…Ù†Ø¹ Ù‚Ø±Ø§Ø¡Ø§Øª Ù…ØªØ¹Ø¯Ø¯Ø©
        stopScanner(mode);
        // Ù†Ù…Ù„Ø£ Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« ÙˆÙ†Ù†ÙÙ‘Ø° Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ø§Ø³Ø­
        search(true, mode, decodedText);
      };
      const onError = (err) => {
        // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ø®Ø·Ø£ ØµØºÙŠØ±
        console.debug("qr scan error:", err);
      };

      scanner.start(
        { facingMode: "environment" },
        config,
        onSuccess,
        onError
      ).then(() => {
        if (mode === 'qr') qrScanner = scanner;
        else scaleScanner = scanner;
      }).catch(err => {
        alert("Ø®Ø·Ø£ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§: " + err);
        targetDiv.style.display = 'none';
        scanningMode = null;
      });
    }

    function stopScanner(mode) {
      const scanner = (mode === 'qr') ? qrScanner : scaleScanner;
      const targetDiv = (mode === 'qr') ? reader : readerScale;
      if (scanner) {
        scanner.stop().then(() => {
          scanner.clear();
          if (mode === 'qr') qrScanner = null;
          else scaleScanner = null;
          targetDiv.style.display = 'none';
          scanningMode = null;
        }).catch(err => {
          console.warn("Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø³Ø­:", err);
          targetDiv.style.display = 'none';
          scanningMode = null;
        });
      } else {
        targetDiv.style.display = 'none';
        scanningMode = null;
      }
    }

    /* ===== Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ© =====
       - Ø¶Ø¹ Ù…Ù„Ù product.template(176).xlsx ÙÙŠ Ù†ÙØ³ Ø§Ù„Ù…Ø³Ø§Ø± Ù„ØªØ¹Ù…Ù„ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.
       - Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ÙŠØ¯ÙˆÙŠ: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… ÙŠØ¸Ù‡Ø± ÙÙŠ Ø¹Ù…ÙˆØ¯ QR Ø£Ùˆ Ø¹Ù…ÙˆØ¯ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù† ÙØ³ÙŠÙ†ØªÙ‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù…Ø§Ù„.
       - Ø²Ø±Ù‘ QR Ùˆ Ø²Ø±Ù‘ ÙƒÙˆØ¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù† ÙŠÙØ¹Ù„Ø§Ù† Ù†ÙØ³ Ø§Ù„Ø³Ù„ÙˆÙƒ Ù„ÙƒÙ† ÙŠÙØ­ØµØ§Ù† Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…Ø®ØªÙ„Ù Ø¹Ù†Ø¯ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©.
    */
  </script>
</body>
</html>
